<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Jeu - Terrain OpacitÃ© 100%</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
        }
        #game-container {
            border: 2px solid #fff;
            margin: 20px 0;
        }
        .info {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .controls {
            background: #444;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .controls button {
            background: #666;
            color: #fff;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        .controls button:hover {
            background: #888;
        }
        .success {
            background: #2a4a2a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #4f8;
        }
        .warning {
            background: #4a2a2a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #f84;
        }
    </style>
</head>
<body>
    <h1>ğŸ® Test Jeu Principal - Terrain OpacitÃ© 100%</h1>
    
    <div class="success">
        <h3>âœ… Test du Terrain dans le Jeu Complet</h3>
        <p><strong>Cette page teste le terrain avec opacitÃ© 100% dans le contexte du jeu principal.</strong></p>
        <ul>
            <li>âœ… <strong>MÃªme code</strong> que le jeu principal (GameScene.js)</li>
            <li>âœ… <strong>Terrain rechargÃ©</strong> avec objets Phaser natifs</li>
            <li>âœ… <strong>Cache forcÃ©</strong> Ã  se recharger</li>
            <li>âœ… <strong>Validation directe</strong> de l'opacitÃ© dans le jeu</li>
        </ul>
    </div>
    
    <div class="warning">
        <h4>âš ï¸ ProblÃ¨me de Cache Possible</h4>
        <p>Si le terrain n'est pas opaque dans le jeu principal, cela peut Ãªtre dÃ» au cache du navigateur qui utilise encore l'ancien fichier AlienTerrain.js.</p>
        <p><strong>Solutions :</strong></p>
        <ul>
            <li>Rechargez avec <kbd>Ctrl+F5</kbd> (Windows) ou <kbd>Cmd+Shift+R</kbd> (Mac)</li>
            <li>Videz le cache du navigateur</li>
            <li>Ouvrez en navigation privÃ©e</li>
        </ul>
    </div>
    
    <div class="info">
        <h3>ğŸ¯ Test du Terrain dans le Contexte de Jeu</h3>
        <p>Ce test simule exactement le comportement du jeu principal :</p>
        <ul>
            <li><strong>GameScene</strong> : MÃªme logique de crÃ©ation du terrain</li>
            <li><strong>LevelManager</strong> : Gestion des niveaux identique</li>
            <li><strong>AlienTerrain</strong> : Utilisation du nouveau systÃ¨me avec objets solides</li>
            <li><strong>Collisions</strong> : MÃªme systÃ¨me de dÃ©tection</li>
        </ul>
    </div>
    
    <div class="controls">
        <h3>ğŸ® Test Terrain dans le Jeu</h3>
        <button onclick="startGameLevel(1)">DÃ©marrer Niveau 1</button>
        <button onclick="startGameLevel(2)">DÃ©marrer Niveau 2</button>
        <button onclick="startGameLevel(3)">DÃ©marrer Niveau 3</button>
        <button onclick="startGameLevel(4)">DÃ©marrer Niveau 4</button>
        <button onclick="startGameLevel(5)">DÃ©marrer Niveau 5</button>
        <button onclick="forceReload()">Forcer Rechargement</button>
    </div>
    
    <div class="info" id="validation">
        <h3>âœ… Validation Terrain dans le Jeu</h3>
        <div id="validation-info">
            <p><strong>VÃ©rifiez que :</strong></p>
            <ul>
                <li>âœ… <strong>Terrain 100% opaque</strong> dans le contexte de jeu</li>
                <li>âœ… <strong>Objets Phaser natifs</strong> utilisÃ©s (pas de graphics)</li>
                <li>âœ… <strong>Collisions fonctionnelles</strong> avec le terrain solide</li>
                <li>âœ… <strong>Niveaux diffÃ©renciÃ©s</strong> (1 sombre, 2 clair, etc.)</li>
            </ul>
        </div>
    </div>
    
    <div id="game-container"></div>

    <!-- Phaser.js -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    
    <!-- Game files - FORCÃ‰ Ã€ RECHARGER -->
    <script src="js/config.js?v=<?php echo time(); ?>"></script>
    <script src="js/managers/ScoreManager.js?v=<?php echo time(); ?>"></script>
    <script src="js/managers/LevelManager.js?v=<?php echo time(); ?>"></script>
    <script src="js/entities/Player.js?v=<?php echo time(); ?>"></script>
    <script src="js/entities/Enemy.js?v=<?php echo time(); ?>"></script>
    <script src="js/entities/Bullet.js?v=<?php echo time(); ?>"></script>
    <script src="js/entities/Boss.js?v=<?php echo time(); ?>"></script>
    <script src="js/entities/AlienTerrain.js?v=<?php echo time(); ?>"></script>
    <script src="js/scenes/PreloadScene.js?v=<?php echo time(); ?>"></script>
    
    <script>
        let game;
        let gameScene;
        
        // Configuration Phaser pour test du jeu avec terrain opaque
        const testConfig = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            backgroundColor: '#001122',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };
        
        function preload() {
            console.log('ğŸ”§ Loading game assets with forced cache refresh...');
            
            // CrÃ©er les sprites du joueur et des ennemis
            createGameSprites.call(this);
            
            console.log('âœ… Game assets loaded for terrain opacity test');
        }
        
        function createGameSprites() {
            // Sprite du joueur (DeLorean)
            const playerGraphics = this.add.graphics();
            playerGraphics.fillStyle(0x888888);
            playerGraphics.fillRect(0, 15, 60, 30);
            playerGraphics.fillStyle(0xaaaaaa);
            playerGraphics.fillRect(5, 10, 50, 10);
            playerGraphics.fillRect(5, 40, 50, 10);
            playerGraphics.fillStyle(0x00ffff);
            playerGraphics.fillRect(45, 20, 15, 20);
            playerGraphics.generateTexture('player', 60, 60);
            playerGraphics.destroy();
            
            // Sprites des ennemis
            const enemyGraphics = this.add.graphics();
            enemyGraphics.fillStyle(0xff4444);
            enemyGraphics.fillRect(0, 10, 40, 20);
            enemyGraphics.fillStyle(0xff6666);
            enemyGraphics.fillRect(5, 5, 30, 10);
            enemyGraphics.fillRect(5, 25, 30, 10);
            enemyGraphics.generateTexture('enemy', 40, 40);
            enemyGraphics.destroy();
            
            // Sprite des balles
            const bulletGraphics = this.add.graphics();
            bulletGraphics.fillStyle(0x00ff00);
            bulletGraphics.fillRect(0, 0, 10, 4);
            bulletGraphics.generateTexture('bullet', 10, 4);
            bulletGraphics.destroy();
            
            // Sprite des balles ennemies
            const enemyBulletGraphics = this.add.graphics();
            enemyBulletGraphics.fillStyle(0xff4444);
            enemyBulletGraphics.fillRect(0, 0, 8, 3);
            enemyBulletGraphics.generateTexture('enemy-bullet', 8, 3);
            enemyBulletGraphics.destroy();
        }
        
        function create() {
            gameScene = this;
            
            // Initialiser les managers comme dans le jeu principal
            this.scoreManager = new ScoreManager();
            this.levelManager = new LevelManager();
            this.levelManager.currentLevel = 1;
            
            // CrÃ©er les groupes comme dans GameScene
            this.playerBullets = this.physics.add.group();
            this.enemyBullets = this.physics.add.group();
            this.enemies = this.physics.add.group();
            this.bosses = this.physics.add.group();
            
            // CRÃ‰ER LE TERRAIN ALIEN - MÃŠME CODE QUE GAMESCENE
            console.log('ğŸŒ Creating AlienTerrain with full opacity objects...');
            this.alienTerrain = new AlienTerrain(this);
            console.log('âœ… AlienTerrain created in game context');
            
            // CrÃ©er le joueur
            this.player = this.physics.add.sprite(100, GameConfig.height / 2, 'player');
            this.player.setCollideWorldBounds(true);
            
            // Collisions joueur vs terrain (comme dans GameScene)
            this.physics.add.overlap(this.player, this.alienTerrain, (player, terrain) => {
                console.log('ğŸ’¥ Player hit terrain!');
                // Effet visuel de collision
                player.setTint(0xff0000);
                this.time.delayedCall(200, () => {
                    player.clearTint();
                });
            });
            
            // ContrÃ´les
            this.cursors = this.input.keyboard.createCursorKeys();
            this.spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
            
            // Texte d'information
            this.add.text(10, 10, 'Test Jeu - Terrain OpacitÃ© 100% (Objets Phaser)', {
                fontSize: '14px',
                fill: '#00ff00'
            });
            
            this.add.text(10, 30, `Niveau ${this.levelManager.currentLevel} - Utilisez les flÃ¨ches pour bouger`, {
                fontSize: '11px',
                fill: '#00ff00'
            });
            
            this.add.text(10, 50, 'Le terrain doit Ãªtre 100% opaque avec objets solides', {
                fontSize: '11px',
                fill: '#ffff00'
            });
            
            updateValidationInfo(this.levelManager.currentLevel);
            
            console.log('âœ… Game context terrain test ready');
        }
        
        function update() {
            if (!this.player || !this.cursors) return;
            
            // ContrÃ´les du joueur
            this.player.setVelocity(0);
            
            if (this.cursors.left.isDown) {
                this.player.setVelocityX(-200);
            } else if (this.cursors.right.isDown) {
                this.player.setVelocityX(200);
            }
            
            if (this.cursors.up.isDown) {
                this.player.setVelocityY(-200);
            } else if (this.cursors.down.isDown) {
                this.player.setVelocityY(200);
            }
        }
        
        function startGameLevel(level) {
            console.log(`ğŸ® Starting game level ${level} with full opacity terrain`);
            
            if (gameScene && gameScene.levelManager) {
                gameScene.levelManager.currentLevel = level;
                
                // RecrÃ©er le terrain pour le nouveau niveau
                if (gameScene.alienTerrain) {
                    gameScene.alienTerrain.destroy();
                }
                
                console.log(`ğŸŒ Creating terrain for level ${level}...`);
                gameScene.alienTerrain = new AlienTerrain(gameScene);
                
                // RecrÃ©er les collisions
                gameScene.physics.add.overlap(gameScene.player, gameScene.alienTerrain, (player, terrain) => {
                    console.log('ğŸ’¥ Player hit terrain!');
                    player.setTint(0xff0000);
                    gameScene.time.delayedCall(200, () => {
                        player.clearTint();
                    });
                });
                
                updateValidationInfo(level);
            }
        }
        
        function forceReload() {
            console.log('ğŸ”„ Forcing page reload to clear cache...');
            location.reload(true); // Force reload from server
        }
        
        function updateValidationInfo(level) {
            const validationDiv = document.getElementById('validation-info');
            
            const levelDescriptions = {
                1: 'AstÃ©roÃ¯des Sombres (objets rectangles + cercles sombres)',
                2: 'AstÃ©roÃ¯des Clairs (objets rectangles + cercles clairs)',
                3: 'Mars (objets rectangles martiens + cercles de fer)',
                4: 'Lune (objets rectangles lunaires + ellipses de roches)',
                5: 'Alien (objets rectangles organiques + polygones de cristaux)'
            };
            
            validationDiv.innerHTML = `
                <h4>ğŸŒ Niveau ${level} - ${levelDescriptions[level]}</h4>
                <p><strong>VÃ©rifiez que :</strong></p>
                <ul>
                    <li>âœ… <strong>Terrain 100% opaque</strong> dans le contexte de jeu</li>
                    <li>âœ… <strong>Objets Phaser natifs</strong> utilisÃ©s (pas de graphics)</li>
                    <li>âœ… <strong>Collisions fonctionnelles</strong> avec le terrain solide</li>
                    <li>âœ… <strong>MÃªme rendu</strong> que dans test-terrain-full-opacity.html</li>
                </ul>
                <p><strong>Test de collision :</strong> Dirigez le vaisseau vers le terrain pour tester les collisions.</p>
                <p><em>ğŸ’¡ Si le terrain n'est pas opaque, utilisez "Forcer Rechargement" pour vider le cache.</em></p>
            `;
        }
        
        // Initialiser le jeu
        game = new Phaser.Game(testConfig);
        
        // Message de validation aprÃ¨s 3 secondes
        setTimeout(() => {
            console.log('âœ… Validation: Le terrain doit Ãªtre 100% opaque dans le contexte de jeu');
            console.log('ğŸ”§ Si ce n\'est pas le cas, le cache du navigateur utilise peut-Ãªtre l\'ancien fichier');
        }, 3000);
    </script>
</body>
</html>
