<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Terrain - Approche Bitmap/Sprite</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
        }
        #game-container {
            border: 2px solid #fff;
            margin: 20px 0;
        }
        .info {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .controls {
            background: #444;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .controls button {
            background: #666;
            color: #fff;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        .controls button:hover {
            background: #888;
        }
        .success {
            background: #2a4a2a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #4f8;
        }
        .technical {
            background: #2a2a4a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #44f;
        }
    </style>
</head>
<body>
    <h1>üé® Test Terrain - Approche Bitmap/Sprite</h1>
    
    <div class="success">
        <h3>‚úÖ Nouvelle Approche - Textures Bitmap + Sprites</h3>
        <p><strong>Le terrain utilise maintenant des textures bitmap g√©n√©r√©es et des sprites Phaser !</strong></p>
        <ul>
            <li>‚úÖ <strong>Textures bitmap</strong> : G√©n√©r√©es avec graphics.generateTexture()</li>
            <li>‚úÖ <strong>Sprites TileSprite</strong> : scene.add.tileSprite() pour affichage</li>
            <li>‚úÖ <strong>Opacit√© garantie</strong> : Les sprites sont toujours 100% opaques</li>
            <li>‚úÖ <strong>Performance optimis√©e</strong> : R√©utilisation des textures</li>
        </ul>
    </div>
    
    <div class="technical">
        <h4>üîß Changement Technique Radical</h4>
        <p><strong>Approche Pr√©c√©dente (Probl√©matique) :</strong></p>
        <pre><code>// Objets Phaser natifs (parfois semi-transparents)
const rect = scene.add.rectangle(x, y, width, height, color);</code></pre>
        
        <p><strong>Nouvelle Approche (Bitmap + Sprite) :</strong></p>
        <pre><code>// 1. Cr√©er texture bitmap
graphics.generateTexture('terrain-key', width, height);

// 2. Utiliser comme sprite
const sprite = scene.add.tileSprite(x, y, w, h, 'terrain-key');</code></pre>
    </div>
    
    <div class="info">
        <h3>üéØ Processus de Cr√©ation Bitmap</h3>
        <p>Chaque type de terrain suit ce processus :</p>
        <ol>
            <li><strong>Cr√©ation Graphics</strong> : Dessiner avec graphics.fillStyle()</li>
            <li><strong>G√©n√©ration Texture</strong> : graphics.generateTexture() ‚Üí bitmap</li>
            <li><strong>Destruction Graphics</strong> : graphics.destroy() (lib√®re m√©moire)</li>
            <li><strong>Cr√©ation Sprites</strong> : scene.add.tileSprite() avec la texture</li>
            <li><strong>Physique</strong> : physics.add.existing() pour collisions</li>
        </ol>
    </div>
    
    <div class="controls">
        <h3>üéÆ Test Terrain Bitmap</h3>
        <button onclick="testLevel(1)">Niveau 1 - Ast√©ro√Ødes Sombres (Bitmap)</button>
        <button onclick="testLevel(2)">Niveau 2 - Ast√©ro√Ødes Clairs (Bitmap)</button>
        <button onclick="testLevel(3)">Niveau 3 - Mars (Bitmap)</button>
        <button onclick="testLevel(4)">Niveau 4 - Lune (Bitmap)</button>
        <button onclick="testLevel(5)">Niveau 5 - Alien (Bitmap)</button>
        <button onclick="showTextureInfo()">Info Textures</button>
    </div>
    
    <div class="info" id="validation">
        <h3>‚úÖ Validation Terrain Bitmap</h3>
        <div id="validation-info">
            <p><strong>V√©rifiez que :</strong></p>
            <ul>
                <li>‚úÖ <strong>Terrain 100% opaque</strong> : Sprites bitmap toujours solides</li>
                <li>‚úÖ <strong>Textures d√©taill√©es</strong> : Crat√®res, rochers, formations visibles</li>
                <li>‚úÖ <strong>Performance fluide</strong> : R√©utilisation des textures</li>
                <li>‚úÖ <strong>Niveaux distincts</strong> : Chaque niveau a sa texture unique</li>
            </ul>
        </div>
    </div>
    
    <div id="game-container"></div>

    <!-- Phaser.js -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    
    <!-- Game files -->
    <script src="js/config.js"></script>
    <script src="js/managers/ScoreManager.js"></script>
    <script src="js/managers/LevelManager.js"></script>
    <script src="js/entities/AlienTerrain.js"></script>
    
    <script>
        let game;
        let gameScene;
        let currentTerrain;
        
        // Configuration Phaser pour test terrain bitmap
        const testConfig = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            backgroundColor: '#001122',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };
        
        function preload() {
            console.log('üîß Loading assets for bitmap terrain test...');
            // Pas besoin de charger d'assets, les textures sont g√©n√©r√©es
        }
        
        function create() {
            gameScene = this;
            
            // Initialiser le level manager
            this.levelManager = { currentLevel: 1 };
            
            // Cr√©er le terrain initial (niveau 1) avec approche bitmap
            currentTerrain = new AlienTerrain(this);
            
            // Texte d'information
            this.add.text(10, 10, 'Terrain BITMAP/SPRITE - Textures G√©n√©r√©es', {
                fontSize: '16px',
                fill: '#00ff00'
            });
            
            this.add.text(10, 30, 'TileSprite avec textures bitmap - Opacit√© 100% garantie', {
                fontSize: '11px',
                fill: '#00ff00'
            });
            
            this.add.text(10, 50, 'Nouvelle approche pour r√©soudre la semi-transparence', {
                fontSize: '12px',
                fill: '#ffff00'
            });
            
            updateValidationInfo(1);
            
            console.log('‚úÖ Bitmap terrain system ready for testing');
        }
        
        function update() {
            // Pas de logique d'update n√©cessaire
        }
        
        function testLevel(level) {
            console.log(`üé® Testing level ${level} terrain (BITMAP APPROACH)`);
            
            // Nettoyer le terrain pr√©c√©dent
            if (currentTerrain) {
                currentTerrain.destroy();
            }
            
            // Changer le niveau
            gameScene.levelManager.currentLevel = level;
            
            // Cr√©er le nouveau terrain avec textures bitmap
            currentTerrain = new AlienTerrain(gameScene);
            
            updateValidationInfo(level);
        }
        
        function showTextureInfo() {
            console.log('üé® Texture Information:');
            
            // Lister les textures cr√©√©es
            const textureManager = gameScene.textures;
            const textureKeys = textureManager.list;
            
            console.log('üìã Available textures:');
            Object.keys(textureKeys).forEach(key => {
                if (key.startsWith('terrain-')) {
                    const texture = textureKeys[key];
                    console.log(`‚úÖ ${key}: ${texture.source[0].width}x${texture.source[0].height}px`);
                }
            });
            
            // Afficher dans l'interface
            const validationDiv = document.getElementById('validation-info');
            const terrainTextures = Object.keys(textureKeys).filter(key => key.startsWith('terrain-'));
            
            validationDiv.innerHTML = `
                <h4>üé® Textures Bitmap G√©n√©r√©es</h4>
                <p><strong>Textures disponibles :</strong></p>
                <ul>
                    ${terrainTextures.map(key => {
                        const texture = textureKeys[key];
                        const width = texture.source[0].width;
                        const height = texture.source[0].height;
                        return `<li><strong>${key}</strong>: ${width}x${height}px (bitmap)</li>`;
                    }).join('')}
                </ul>
                <p><strong>Avantages de l'approche bitmap :</strong></p>
                <ul>
                    <li>‚úÖ Textures r√©utilisables (performance)</li>
                    <li>‚úÖ Sprites TileSprite toujours 100% opaques</li>
                    <li>‚úÖ D√©tails pr√©cis dans la texture</li>
                    <li>‚úÖ Gestion m√©moire optimis√©e</li>
                </ul>
            `;
        }
        
        function updateValidationInfo(level) {
            const validationDiv = document.getElementById('validation-info');
            
            const levelDescriptions = {
                1: {
                    name: 'üåë Niveau 1 - Ast√©ro√Ødes Sombres (Bitmap)',
                    texture: 'terrain-asteroid-dark',
                    features: [
                        'Texture bitmap 100x80px g√©n√©r√©e',
                        'Base sombre (#2A2A2A) avec couches rocheuses',
                        'Crat√®res et rochers int√©gr√©s dans la texture',
                        'TileSprite pour affichage r√©p√©table'
                    ]
                },
                2: {
                    name: 'üå´Ô∏è Niveau 2 - Ast√©ro√Ødes Clairs (Bitmap)',
                    texture: 'terrain-asteroid-light',
                    features: [
                        'Texture bitmap 100x80px g√©n√©r√©e',
                        'Base claire (#6A6A6A) avec reflets',
                        'Crat√®res avec rebords lumineux',
                        'Rochers avec highlights int√©gr√©s'
                    ]
                },
                3: {
                    name: 'üî¥ Niveau 3 - Mars (Bitmap)',
                    texture: 'terrain-mars',
                    features: [
                        'Texture bitmap 100x80px g√©n√©r√©e',
                        'Base martienne (#8B4513) avec s√©diments',
                        'Formations rocheuses et oxyde de fer',
                        'Poussi√®re martienne int√©gr√©e'
                    ]
                },
                4: {
                    name: 'üåï Niveau 4 - Lune (Bitmap)',
                    texture: 'terrain-moon',
                    features: [
                        'Texture bitmap 100x80px g√©n√©r√©e',
                        'Base lunaire (#8C8C8C) avec r√©golithe',
                        'Crat√®res avec √©jecta et pics centraux',
                        'Traces de microm√©torites'
                    ]
                },
                5: {
                    name: 'üëΩ Niveau 5 - Alien (Bitmap)',
                    texture: 'terrain-alien',
                    features: [
                        'Texture bitmap 100x80px g√©n√©r√©e',
                        'Base organique color√©e (palette alien)',
                        'Formations organiques et cristaux',
                        'V√©g√©tation bioluminescente int√©gr√©e'
                    ]
                }
            };
            
            const info = levelDescriptions[level];
            
            validationDiv.innerHTML = `
                <h4>${info.name}</h4>
                <p><strong>Texture utilis√©e :</strong> <code>${info.texture}</code></p>
                <p><strong>V√©rifiez que :</strong></p>
                <ul>
                    <li>‚úÖ <strong>Terrain 100% opaque</strong> : Sprites bitmap toujours solides</li>
                    <li>‚úÖ <strong>Textures d√©taill√©es</strong> : Tous les √©l√©ments visibles</li>
                    <li>‚úÖ <strong>Performance fluide</strong> : Pas de ralentissement</li>
                    <li>‚úÖ <strong>R√©p√©tition propre</strong> : TileSprite sans artefacts</li>
                </ul>
                <p><strong>Caract√©ristiques de la texture :</strong></p>
                <ul>
                    ${info.features.map(feature => `<li>${feature}</li>`).join('')}
                </ul>
                <p><em>üí° Utilisez "Info Textures" pour voir toutes les textures g√©n√©r√©es.</em></p>
            `;
        }
        
        // Initialiser le jeu
        game = new Phaser.Game(testConfig);
        
        // Message de validation apr√®s 3 secondes
        setTimeout(() => {
            console.log('‚úÖ Validation: Le terrain bitmap doit √™tre 100% opaque avec des textures d√©taill√©es');
        }, 3000);
    </script>
</body>
</html>
