<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Terrain - Correction Carr√©s Verts</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
        }
        #game-container {
            border: 2px solid #fff;
            margin: 20px 0;
        }
        .info {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .controls {
            background: #444;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .controls button {
            background: #666;
            color: #fff;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        .controls button:hover {
            background: #888;
        }
        .success {
            background: #2a4a2a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #4f8;
        }
        .warning {
            background: #4a2a2a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #f84;
        }
    </style>
</head>
<body>
    <h1>üîß Test Terrain - Correction Carr√©s Verts</h1>
    
    <div class="success">
        <h3>‚úÖ Probl√®me des Carr√©s Verts Corrig√©</h3>
        <p><strong>Les carr√©s verts qui s'affichaient par-dessus le terrain ont √©t√© supprim√©s !</strong></p>
        <ul>
            <li>‚úÖ <strong>Collision invisible</strong> : Zones de collision sans affichage visuel</li>
            <li>‚úÖ <strong>Terrain propre</strong> : Seules les textures proc√©durales sont visibles</li>
            <li>‚úÖ <strong>Physique pr√©serv√©e</strong> : Les collisions fonctionnent toujours</li>
            <li>‚úÖ <strong>Performance optimis√©e</strong> : Moins d'objets graphiques</li>
        </ul>
    </div>
    
    <div class="warning">
        <h4>‚ö†Ô∏è Probl√®me Pr√©c√©dent</h4>
        <p>Les <code>staticImage</code> avec texture <code>null</code> cr√©aient des carr√©s verts par d√©faut de Phaser.js. Maintenant remplac√©s par des <code>zones</code> invisibles.</p>
    </div>
    
    <div class="info">
        <h3>üéØ Correction Technique</h3>
        <p><strong>Avant :</strong></p>
        <pre><code>const body = this.scene.physics.add.staticImage(x, y, null); // ‚ùå Carr√© vert</code></pre>
        <p><strong>Apr√®s :</strong></p>
        <pre><code>const zone = this.scene.add.zone(x, y, width, height);      // ‚úÖ Invisible
this.scene.physics.add.existing(zone, true);</code></pre>
    </div>
    
    <div class="controls">
        <h3>üéÆ Test des Terrains Sans Carr√©s Verts</h3>
        <button onclick="testTerrain('asteroid')">Terrain Ast√©ro√Øde</button>
        <button onclick="testTerrain('mars')">Terrain Mars</button>
        <button onclick="testTerrain('moon')">Terrain Lunaire</button>
        <button onclick="testTerrain('alien')">Terrain Alien</button>
        <button onclick="toggleCollisionDebug()">Toggle Debug Collision</button>
    </div>
    
    <div class="info" id="validation">
        <h3>‚úÖ Validation Visuelle</h3>
        <div id="validation-info">
            <p><strong>V√©rifiez que :</strong></p>
            <ul>
                <li>‚ùå <strong>Aucun carr√© vert</strong> n'est visible sur le terrain</li>
                <li>‚úÖ <strong>Seules les textures</strong> proc√©durales sont affich√©es</li>
                <li>‚úÖ <strong>Les collisions</strong> fonctionnent toujours (test avec debug)</li>
                <li>‚úÖ <strong>L'affichage</strong> est propre et immersif</li>
            </ul>
        </div>
    </div>
    
    <div id="game-container"></div>

    <!-- Phaser.js -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    
    <!-- Game files -->
    <script src="js/config.js"></script>
    <script src="js/managers/ScoreManager.js"></script>
    <script src="js/managers/LevelManager.js"></script>
    <script src="js/entities/AlienTerrain.js"></script>
    
    <script>
        let game;
        let gameScene;
        let currentTerrain;
        let debugMode = false;
        
        // Configuration Phaser pour test sans carr√©s verts
        const testConfig = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            backgroundColor: '#001122',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false // Commencer sans debug
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };
        
        function preload() {
            console.log('üîß Loading assets for green squares fix test...');
            // Pas besoin d'assets, tout est proc√©dural
        }
        
        function create() {
            gameScene = this;
            
            // Initialiser le level manager
            this.levelManager = { currentLevel: 1 };
            
            // Cr√©er le terrain initial (ast√©ro√Øde)
            currentTerrain = new AlienTerrain(this);
            
            // Texte d'information
            this.add.text(10, 10, 'Test Terrain - CARR√âS VERTS CORRIG√âS', {
                fontSize: '16px',
                fill: '#00ff00'
            });
            
            this.add.text(10, 30, 'Zones de collision invisibles - Affichage propre', {
                fontSize: '11px',
                fill: '#00ff00'
            });
            
            this.add.text(10, 50, 'Fini les carr√©s verts par-dessus le terrain !', {
                fontSize: '12px',
                fill: '#ffff00'
            });
            
            console.log('‚úÖ Green squares fix ready for testing');
        }
        
        function update() {
            // Pas de logique d'update n√©cessaire
        }
        
        function testTerrain(terrainType) {
            console.log(`üåç Testing ${terrainType} terrain (no green squares)`);
            
            // Changer le niveau pour correspondre au terrain
            const levelMap = {
                'asteroid': 1,
                'mars': 3,
                'moon': 4,
                'alien': 5
            };
            
            gameScene.levelManager.currentLevel = levelMap[terrainType];
            
            // Changer le type de terrain
            if (currentTerrain) {
                currentTerrain.changeTerrainType(terrainType);
            }
            
            updateValidationInfo(terrainType);
        }
        
        function toggleCollisionDebug() {
            debugMode = !debugMode;
            
            // Red√©marrer la sc√®ne avec le nouveau mode debug
            gameScene.physics.world.debugGraphic.clear();
            gameScene.physics.world.drawDebug = debugMode;
            
            if (debugMode) {
                gameScene.physics.world.createDebugGraphic();
                console.log('üîç Debug collision activ√© - Les zones de collision sont maintenant visibles');
            } else {
                if (gameScene.physics.world.debugGraphic) {
                    gameScene.physics.world.debugGraphic.destroy();
                }
                console.log('üëÅÔ∏è Debug collision d√©sactiv√© - Affichage normal');
            }
            
            updateValidationInfo(null, debugMode);
        }
        
        function updateValidationInfo(terrainType, debugActive) {
            const validationDiv = document.getElementById('validation-info');
            
            let debugInfo = '';
            if (debugActive !== undefined) {
                debugInfo = debugActive ? 
                    '<p><strong>üîç Mode Debug Actif :</strong> Les zones de collision sont visibles en contours color√©s.</p>' :
                    '<p><strong>üëÅÔ∏è Mode Normal :</strong> Seules les textures proc√©durales sont visibles.</p>';
            }
            
            const terrainInfo = terrainType ? 
                `<p><strong>Terrain actuel :</strong> ${terrainType.toUpperCase()}</p>` : '';
            
            validationDiv.innerHTML = `
                ${terrainInfo}
                ${debugInfo}
                <p><strong>V√©rifiez que :</strong></p>
                <ul>
                    <li>‚ùå <strong>Aucun carr√© vert</strong> n'est visible sur le terrain</li>
                    <li>‚úÖ <strong>Seules les textures</strong> proc√©durales sont affich√©es</li>
                    <li>‚úÖ <strong>Les collisions</strong> fonctionnent toujours (activez le debug pour voir)</li>
                    <li>‚úÖ <strong>L'affichage</strong> est propre et immersif</li>
                </ul>
                <p><em>üí° Utilisez le bouton "Toggle Debug Collision" pour voir les zones de collision sans les carr√©s verts.</em></p>
            `;
        }
        
        // Initialiser le jeu
        game = new Phaser.Game(testConfig);
        
        // Message de validation apr√®s 3 secondes
        setTimeout(() => {
            console.log('‚úÖ Validation: V√©rifiez qu\'aucun carr√© vert n\'est visible sur le terrain');
            updateValidationInfo('asteroid');
        }, 3000);
    </script>
</body>
</html>
